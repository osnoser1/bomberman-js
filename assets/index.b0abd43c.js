var De=Object.defineProperty,Le=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var T=(t,e,s)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,U=(t,e)=>{for(var s in e||(e={}))Me.call(e,s)&&T(t,s,e[s]);if(se)for(var s of se(e))xe.call(e,s)&&T(t,s,e[s]);return t},H=(t,e)=>Le(t,_e(e));var p=(t,e,s)=>(T(t,typeof e!="symbol"?e+"":e,s),s),J=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var a=(t,e,s)=>(J(t,e,"read from private field"),s?s.call(t):e.get(t)),c=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},l=(t,e,s,r)=>(J(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);var x=(t,e,s)=>(J(t,e,"access private method"),s);import{i as fe,r as D,o as Ce,m as Ae,a as Se,n as Ee,p as ge}from"./vendor.b8ce2bad.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}};$e();var b=(t=>(t[t.BALLOOM=0]="BALLOOM",t[t.ONEAL=1]="ONEAL",t[t.DOLL=2]="DOLL",t[t.MINVO=3]="MINVO",t[t.KONDORIA=4]="KONDORIA",t[t.OVAPI=5]="OVAPI",t[t.PASS=6]="PASS",t[t.PONTAN=7]="PONTAN",t[t.Length=8]="Length",t))(b||{});const ee={};function L(t){return e=>{Ne(H(U({},t),{enemyClass:e}))}}function Ne(t){if(fe(t.type))throw new TypeError("config.type is required");if(ee[t.type])throw new Error(`The enemy with the name "${t.enemyClass.name}" has already exists, please try another name!`);ee[t.type]=t.enemyClass}function Be(t){return ee[t]}const z=0,I=1,ie=Number.EPSILON;var f,A,S,j,G;const d=class{constructor(){c(this,j);c(this,f,void 0);c(this,A,void 0);c(this,S,void 0);l(this,f,x(this,j,G).call(this,z,I)),l(this,A,[]),l(this,S,[])}get emptyMap(){return x(this,j,G).call(this,z,I)}get value(){return a(this,f)}randomBricks(){l(this,f,x(this,j,G).call(this,z,I)),l(this,A,[]);for(let e=0;e<d.BrickCount;e++)do{let s=D(d.Columns-2),r=D(d.Rows-2);if(!(s<3&&r==1||s==1&&r<3)&&a(this,f)[r][s]===I){a(this,A).push({x:s,y:r}),a(this,f)[r][s]=ie;break}}while(!0);return a(this,A)}randomEnemies(){l(this,S,[]);for(let e=0;e<d.EnemiesCount;e++)do{let s=D(d.Columns-2),r=D(d.Rows-2),i=D(b.Length-1);if(a(this,f)[r][s]===I){a(this,S).push({x:s,y:r,type:i}),a(this,f)[r][s]=ie;break}}while(!0);return a(this,S)}};let P=d;f=new WeakMap,A=new WeakMap,S=new WeakMap,j=new WeakSet,G=function(e,s){const r=[];for(let i=0;i<d.Rows;i++){r.push([]);for(let o=0;o<d.Columns;o++){const n=i%2!=1&&o%2!=1||i==0||i==12||o==0||o==30?e:s;r[i].push(n)}}return r},p(P,"Columns",31),p(P,"Rows",13),p(P,"BrickCount",55),p(P,"EnemiesCount",10);const je=Phaser.Scale.ScaleModes,Re=Phaser.Scale.Center,re=40,oe=40,m={scale:{width:640,height:520},graphics:{tile:{width:re,height:oe},sceneWidth:P.Columns*re,sceneHeight:P.Rows*oe}},Ie={type:Phaser.AUTO,fps:{target:60},pixelArt:!0,scale:{width:m.scale.width,height:m.scale.height,mode:je.FIT,autoCenter:Re.CENTER_BOTH},physics:{default:"arcade",arcade:{debug:!0}}};function be(t,e){return{x:Math.trunc(t/m.graphics.tile.width),y:Math.trunc(e/m.graphics.tile.height)}}const Ve=(t,e)=>s=>t*e+s;function ke(t,e,s,r,i){e.forEach(o=>{s.create({key:o.key,frames:s.generateFrameNumbers(t,{frames:o.frames.map(Ve(o.row,r))}),frameRate:i,repeat:-1})})}const Ue=Phaser.Events.EventEmitter;var O;(t=>{var i,o,n;let e;(h=>{h[h.Up=0]="Up",h[h.Down=1]="Down",h[h.Left=2]="Left",h[h.Right=3]="Right",h[h.A=4]="A",h[h.B=5]="B",h[h.Start=6]="Start",h[h.None=7]="None"})(e=t.Buttons||(t.Buttons={}));class s extends Ue{constructor(){super(...arguments);c(this,i,H(U({},Ce(Ae(e,()=>new r(!1,!0)),(y,M)=>Se(Number(M)))),{[7]:new r(!0,!0)}))}isPressed(...y){return y.some(M=>a(this,i)[M].isPressed())}press(y,M,q=!0){!a(this,i)[y].isEnabled()||(a(this,i)[y].setPressed(M),q&&this.emit("change",this))}pressMany(y,M,q=!0){M.forEach(te=>{!a(this,i)[te].isEnabled()||a(this,i)[te].setPressed(y)}),q&&this.emit("change",this)}}i=new WeakMap,t.Gamepad=s;class r{constructor(B,y){c(this,o,void 0);c(this,n,void 0);l(this,o,B),l(this,n,y)}isPressed(){return a(this,o)}setPressed(B){l(this,o,B)}isEnabled(){return a(this,n)}}o=new WeakMap,n=new WeakMap})(O||(O={}));function He(t){return t%2===0}const Ke=O.Gamepad,u=O.Buttons;var w=(t=>(t[t.Slowest=1]="Slowest",t[t.Slow=2]="Slow",t[t.Mid=4]="Mid",t[t.Fast=5]="Fast",t))(w||{});const Ge={x:[u.Left,u.Right],y:[u.Up,u.Down]},Fe={x:"width",y:"height"};var F,we,W,ye;class Y{constructor(e,s,r,i,o,n,h,B=!1){c(this,F);c(this,W);p(this,"movementType");p(this,"movement");p(this,"gamepad");p(this,"speed");this.name=e,this.sprite=s,this.gamepad=new Ke,this.sprite.setOrigin(0,0),this.sprite.setPosition(r*m.graphics.tile.width,i*m.graphics.tile.height),this.sprite.setImmovable(B),this.sprite.setScale(2.5),ke(this.name,o,this.sprite.anims,n,h),this.sprite.anims.play("initial"),this.gamepad.addListener("change",x(this,F,we),this)}update(e,s){x(this,W,ye).call(this)}handleExtraMovement(e,s){if(this.gamepad.isPressed(...Ge[s]))return;const r=this.sprite.getCenter(),i=r[s]%m.graphics.tile[Fe[s]],o=be(r.x,r.y);He(o[s])||(i>=6&&i<20?this.sprite.body.velocity[s]=e:i>20&&i<34?this.sprite.body.velocity[s]=-e:this.sprite.body.velocity[s]=0)}}F=new WeakSet,we=function(e){e.isPressed(u.Right)?this.sprite.anims.play("right",!0):e.isPressed(u.Left)?this.sprite.anims.play("left",!0):e.isPressed(u.Up)?this.sprite.anims.play("up",!0):e.isPressed(u.Down)?this.sprite.anims.play("down",!0):this.sprite.anims.pause()},W=new WeakSet,ye=function(){const e=this.speed*30;this.gamepad.isPressed(u.Up)?this.sprite.setVelocityY(-e):this.gamepad.isPressed(u.Down)?this.sprite.setVelocityY(e):this.sprite.setVelocityY(0),this.gamepad.isPressed(u.Right)?this.sprite.setVelocityX(e):this.gamepad.isPressed(u.Left)?this.sprite.setVelocityX(-e):this.sprite.setVelocityX(0),this.gamepad.isPressed(u.Right,u.Left)&&this.handleExtraMovement(e,"y"),this.gamepad.isPressed(u.Up,u.Down)&&this.handleExtraMovement(e,"x")};const We=O.Buttons,Xe=6;var X,ve;class Ye extends Y{constructor(s,r,i,o){const n=s.physics.add.sprite(0,0,"bomberman");super("bomberman",n,i,o,[{key:"initial",row:0,frames:[0]},{key:"up",row:1,frames:[2,1,0,1]},{key:"down",row:2,frames:[2,1,0,1]},{key:"right",row:3,frames:[2,1,0,1]},{key:"left",row:4,frames:[2,1,0,1]},{key:"death",row:5,frames:[0,1,2,3,4]}],6,Xe);c(this,X);this.bombs=r,this.speed=w.Mid,this.sprite.setDepth(1)}update(s,r,i,o){super.update(s,r),x(this,X,ve).call(this,i,o)}}X=new WeakSet,ve=function(s,r){if(this.gamepad.isPressed(We.A)&&!s.overlap(this.sprite,this.bombs.group)&&!s.overlap(this.sprite,r.bricks.group)){const i=this.sprite.getCenter(),{x:o,y:n}=be(i.x,i.y);this.bombs.addBomb(o,n)}};const qe=3;class Te extends Y{constructor(e,s,r){super("bomb",e.get(),s,r,[{key:"initial",row:0,frames:[0,1,2]}],6,qe,!0)}}class Je{constructor(e){p(this,"group");this.group=e.physics.add.group({defaultKey:"bomb"})}addBomb(e,s){new Te(this.group,e,s)}}const ze=3;class Qe extends Y{constructor(e,s,r){super("brick",e.get(),s,r,[{key:"initial",row:0,frames:[0]},{key:"dead",row:5,frames:[0,1,2]}],6,ze,!0)}}class Ze{constructor(e){p(this,"group");this.group=e.physics.add.group({defaultKey:"brick"})}generateRandom(e){e.randomBricks().forEach(r=>new Qe(this.group,r.x,r.y))}}const K=O.Buttons;O.Gamepad;var Pe=(t=>(t[t.Low=0]="Low",t[t.Mid=1]="Mid",t[t.High=2]="High",t[t.Impossible=3]="Impossible",t))(Pe||{}),E,R,g,V;class et{constructor(e){c(this,E,void 0);c(this,R,void 0);c(this,g,[]);c(this,V,void 0);if(l(this,E,e),l(this,R,a(this,E).gamepad),a(this,E).movementType===3)throw new Error("Impossible movement type hasn't been implemented")}start(){const e=()=>{a(this,E).movementType===0?this.makeMovement(D(0,3)):this.makeMovement(D(0,1),D(2,3))};e(),l(this,V,setInterval(e,3e3))}stop(){clearInterval(a(this,V))}makeMovement(e,s){a(this,R).pressMany(!1,a(this,g),!1),l(this,g,[]),e===0?a(this,g).push(K.Left):e===1&&a(this,g).push(K.Right),e===2||s===2?a(this,g).push(K.Up):(e===3||s===3)&&a(this,g).push(K.Down),a(this,R).pressMany(!0,a(this,g))}}E=new WeakMap,R=new WeakMap,g=new WeakMap,V=new WeakMap;const tt=5;class _ extends Y{constructor(e,s,r,i){super(e,s,r,i,[{key:"initial",row:1,frames:[0]},{key:"up",row:1,frames:[0,1,2]},{key:"down",row:2,frames:[0,1,2]},{key:"right",row:3,frames:[0,1,2]},{key:"left",row:4,frames:[0,1,2]},{key:"death",row:5,frames:[0,1,2,3]}],5,tt),this.movement=new et(this),this.sprite.setDepth(1),this.sprite.setBounce(1,1)}}var st=Object.defineProperty,it=Object.getOwnPropertyDescriptor,rt=(t,e,s,r)=>{for(var i=r>1?void 0:r?it(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&st(e,s,i),i};let ne=class extends _{constructor(t,e,s){super("balloom",t.get(),e,s),this.speed=w.Slowest,this.movementType=Pe.Low,this.sprite.setDepth(1)}};ne=rt([L({type:b.BALLOOM})],ne);var ot=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,at=(t,e,s,r)=>{for(var i=r>1?void 0:r?nt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&ot(e,s,i),i};let ae=class extends _{constructor(t,e,s){super("doll",t.get(),e,s),this.speed=w.Slow,this.sprite.setDepth(1)}};ae=at([L({type:b.DOLL})],ae);var ht=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,ct=(t,e,s,r)=>{for(var i=r>1?void 0:r?pt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&ht(e,s,i),i};let he=class extends _{constructor(t,e,s){super("kondoria",t.get(),e,s),this.speed=w.Slowest,this.sprite.setDepth(1)}};he=ct([L({type:b.KONDORIA})],he);var lt=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,mt=(t,e,s,r)=>{for(var i=r>1?void 0:r?ut(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&lt(e,s,i),i};let pe=class extends _{constructor(t,e,s){super("minvo",t.get(),e,s),this.speed=w.Mid,this.sprite.setDepth(1)}};pe=mt([L({type:b.MINVO})],pe);var dt=Object.defineProperty,ft=Object.getOwnPropertyDescriptor,gt=(t,e,s,r)=>{for(var i=r>1?void 0:r?ft(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&dt(e,s,i),i};let ce=class extends _{constructor(t,e,s){super("oneal",t.get(),e,s),this.speed=w.Slow,this.sprite.setDepth(1)}};ce=gt([L({type:b.ONEAL})],ce);var bt=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,yt=(t,e,s,r)=>{for(var i=r>1?void 0:r?wt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&bt(e,s,i),i};let le=class extends _{constructor(t,e,s){super("ovapi",t.get(),e,s),this.speed=w.Slowest,this.sprite.setDepth(1)}};le=yt([L({type:b.OVAPI})],le);var vt=Object.defineProperty,Pt=Object.getOwnPropertyDescriptor,Ot=(t,e,s,r)=>{for(var i=r>1?void 0:r?Pt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&vt(e,s,i),i};let ue=class extends _{constructor(t,e,s){super("pass",t.get(),e,s),this.speed=w.Mid,this.sprite.setDepth(1)}};ue=Ot([L({type:b.PASS})],ue);var Dt=Object.defineProperty,Lt=Object.getOwnPropertyDescriptor,_t=(t,e,s,r)=>{for(var i=r>1?void 0:r?Lt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&Dt(e,s,i),i};let me=class extends _{constructor(t,e,s){super("pontan",t.get(),e,s),this.speed=w.Mid,this.sprite.setDepth(1)}};me=_t([L({type:b.PONTAN})],me);var k;class Mt{constructor(e){c(this,k,[]);p(this,"group");this.group=e.physics.add.group({defaultKey:"brick"})}generateRandom(e){e.randomEnemies().forEach(r=>{var n;const i=Be(r.type),o=new i(this.group,r.x,r.y);a(this,k).push(o),(n=o.movement)==null||n.start()})}update(e,s){a(this,k).forEach(r=>r.update(e,s))}}k=new WeakMap;var $,N;class xt{constructor(e){p(this,"itemTileSetLayer");c(this,$,void 0);c(this,N,void 0);p(this,"bricks");p(this,"enemies");l(this,$,new P),l(this,N,e.make.tilemap({data:a(this,$).emptyMap,width:m.graphics.sceneWidth,height:m.graphics.sceneHeight,tileWidth:m.graphics.tile.width,tileHeight:m.graphics.tile.height}));const s=a(this,N).addTilesetImage("items",void 0,16,16);this.itemTileSetLayer=a(this,N).createLayer(0,s),this.bricks=new Ze(e),this.enemies=new Mt(e),a(this,N).setCollision(0)}reset(){this.bricks.generateRandom(a(this,$)),this.enemies.generateRandom(a(this,$))}update(e,s){this.enemies.update(e,s)}}$=new WeakMap,N=new WeakMap;const C=O.Buttons,Oe={Up:C.Up,Down:C.Down,Left:C.Left,Right:C.Right,x:C.A,c:C.B,Enter:C.Start};function de(t,e){return s=>{const r=Oe[e];fe(r)||t.gamepad.press(r,s.isDown)}}function Ct(t,e){const s=t.addKeys(Object.keys(Oe).join(","),!0,!0);Object.entries(s).forEach(([r,i])=>{i.on("down",de(e,r)),i.on("up",de(e,r))})}const v=O.Buttons;function At(t){const e=t.gamepad,s=Ee.create({mode:"static",position:{left:"100px",bottom:"100px"}});s.on("end",()=>{e.pressMany(!1,[v.Right,v.Up,v.Left,v.Down])}),s.on("move",(r,i)=>{const o=[],n=[];let h;!i.distance||(h=i.angle.degree<=60||i.angle.degree>=300?o:n,h.push(v.Right),h=i.angle.degree>=30&&i.angle.degree<=150?o:n,h.push(v.Up),h=i.angle.degree>=120&&i.angle.degree<=240?o:n,h.push(v.Left),h=i.angle.degree>=210&&i.angle.degree<=330?o:n,h.push(v.Down),e.pressMany(!0,o),e.pressMany(!1,n))})}function St(t){const e=t.gamepad,s=document.querySelector("body"),r=document.createElement("div"),i=document.createElement("img");i.src="assets/joystick/bomb-btn.png",r.appendChild(i),Object.assign(r.style,{bottom:"50px",display:"flex",opacity:"0.5",position:"absolute",right:"50px",transition:"opacity 250ms ease 0s"}),Object.assign(i.style,{width:"100px",pointerEvents:"none",userSelect:"none"}),s.appendChild(r);const o=n=>{n.stopPropagation();const h=n.type==="pointerdown";r.style.opacity=h?"0.8":"0.5",e.press(v.A,h)};r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o)}function Et(t){At(t),St(t)}const Q=16,Z=16;class $t extends ge.exports.Scene{constructor(){super("GameScene");p(this,"bomberman");p(this,"bombs");p(this,"tileMap")}preload(){this.load.image("items","assets/map/items.png"),this.load.spritesheet("brick","assets/map/brick.png",{frameWidth:Q,frameHeight:Z}),this.load.spritesheet("bomb","assets/map/bomb.png",{frameWidth:Q,frameHeight:Z}),["bomberman","balloom","doll","kondoria","minvo","oneal","ovapi","pass","pontan"].forEach(s=>this.load.spritesheet(s,`assets/players/${s}.png`,{frameWidth:Q,frameHeight:Z}))}create(){this.tileMap=new xt(this),this.tileMap.reset(),this.cameras.main.setBounds(0,0,m.graphics.sceneWidth,m.graphics.sceneHeight),this.physics.world.setBounds(0,0,m.graphics.sceneWidth,m.graphics.sceneHeight),this.bombs=new Je(this),this.bomberman=new Ye(this,this.bombs,1,1),this.physics.add.collider(this.bomberman.sprite,this.tileMap.itemTileSetLayer),this.physics.add.collider(this.bombs.group,this.tileMap.itemTileSetLayer),this.physics.add.collider(this.bombs.group,this.bombs.group),this.physics.add.collider(this.bomberman.sprite,this.bombs.group),this.physics.add.collider(this.tileMap.enemies.group,[this.bombs.group,this.tileMap.bricks.group]),this.physics.add.collider(this.tileMap.enemies.group,this.tileMap.itemTileSetLayer),this.cameras.main.startFollow(this.bomberman.sprite,!0),Ct(this.input.keyboard,this.bomberman),Et(this.bomberman)}update(s,r){super.update(s,r),this.bomberman.update(s,r,this.physics,this.tileMap),this.tileMap.update(s,r)}}new ge.exports.Game(H(U({},Ie),{scene:[$t]}));
