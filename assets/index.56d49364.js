var Pe=Object.defineProperty,Le=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var J=(t,e,s)=>e in t?Pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,k=(t,e)=>{for(var s in e||(e={}))De.call(e,s)&&J(t,s,e[s]);if(se)for(var s of se(e))Me.call(e,s)&&J(t,s,e[s]);return t},K=(t,e)=>Le(t,_e(e));var p=(t,e,s)=>(J(t,typeof e!="symbol"?e+"":e,s),s),z=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)};var a=(t,e,s)=>(z(t,e,"read from private field"),s?s.call(t):e.get(t)),c=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},l=(t,e,s,r)=>(z(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);var M=(t,e,s)=>(z(t,e,"access private method"),s);import{i as fe,r as L,o as xe,m as Ce,a as Se,n as Ae,p as ge}from"./vendor.b8ce2bad.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}};$e();var g=(t=>(t[t.BALLOOM=0]="BALLOOM",t[t.ONEAL=1]="ONEAL",t[t.DOLL=2]="DOLL",t[t.MINVO=3]="MINVO",t[t.KONDORIA=4]="KONDORIA",t[t.OVAPI=5]="OVAPI",t[t.PASS=6]="PASS",t[t.PONTAN=7]="PONTAN",t[t.Length=8]="Length",t))(g||{});const ee={};function _(t){return e=>{Ne(K(k({},t),{enemyClass:e}))}}function Ne(t){if(fe(t.type))throw new TypeError("config.type is required");if(ee[t.type])throw new Error(`The enemy with the name "${t.enemyClass.name}" has already exists, please try another name!`);ee[t.type]=t.enemyClass}function Ee(t){return ee[t]}const Q=0,I=1,ie=Number.EPSILON;var d,C,S,B,W;const m=class{constructor(){c(this,B);c(this,d,void 0);c(this,C,void 0);c(this,S,void 0);l(this,d,M(this,B,W).call(this,Q,I)),l(this,C,[]),l(this,S,[])}get emptyMap(){return M(this,B,W).call(this,Q,I)}get value(){return a(this,d)}randomBricks(){l(this,d,M(this,B,W).call(this,Q,I)),l(this,C,[]);for(let e=0;e<m.BrickCount;e++)do{let s=L(m.Columns-2),r=L(m.Rows-2);if(!(s<3&&r==1||s==1&&r<3)&&a(this,d)[r][s]===I){a(this,C).push({x:s,y:r}),a(this,d)[r][s]=ie;break}}while(!0);return a(this,C)}randomEnemies(){l(this,S,[]);for(let e=0;e<m.EnemiesCount;e++)do{let s=L(m.Columns-2),r=L(m.Rows-2),i=L(g.Length-1);if(a(this,d)[r][s]===I){a(this,S).push({x:s,y:r,type:i}),a(this,d)[r][s]=ie;break}}while(!0);return a(this,S)}};let v=m;d=new WeakMap,C=new WeakMap,S=new WeakMap,B=new WeakSet,W=function(e,s){const r=[];for(let i=0;i<m.Rows;i++){r.push([]);for(let o=0;o<m.Columns;o++){const n=i%2!=1&&o%2!=1||i==0||i==12||o==0||o==30?e:s;r[i].push(n)}}return r},p(v,"Columns",31),p(v,"Rows",13),p(v,"BrickCount",55),p(v,"EnemiesCount",10);const Be=Phaser.Scale.ScaleModes,je=Phaser.Scale.Center,re=40,oe=40,u={scale:{width:640,height:520},graphics:{tileWidth:re,tileHeight:oe,sceneWidth:v.Columns*re,sceneHeight:v.Rows*oe}},Re={type:Phaser.AUTO,fps:{target:60},pixelArt:!0,scale:{width:u.scale.width,height:u.scale.height,mode:Be.FIT,autoCenter:je.CENTER_BOTH},physics:{default:"arcade",arcade:{debug:!0}}};function Ie(t,e){return{x:Math.trunc(t/u.graphics.tileWidth),y:Math.trunc(e/u.graphics.tileHeight)}}const He=(t,e)=>s=>t*e+s;function Ve(t,e,s,r,i){e.forEach(o=>{s.create({key:o.key,frames:s.generateFrameNumbers(t,{frames:o.frames.map(He(o.row,r))}),frameRate:i,repeat:-1})})}const ke=Phaser.Events.EventEmitter;var O;(t=>{var i,o,n;let e;(h=>{h[h.Up=0]="Up",h[h.Down=1]="Down",h[h.Left=2]="Left",h[h.Right=3]="Right",h[h.A=4]="A",h[h.B=5]="B",h[h.Start=6]="Start",h[h.None=7]="None"})(e=t.Buttons||(t.Buttons={}));class s extends ke{constructor(){super(...arguments);c(this,i,K(k({},xe(Ce(e,()=>new r(!1,!0)),(w,R)=>Se(Number(R)))),{[7]:new r(!0,!0)}))}isPressed(w){return a(this,i)[w].isPressed()}press(w,R,q=!0){!a(this,i)[w].isEnabled()||(a(this,i)[w].setPressed(R),q&&this.emit("change",this))}pressMany(w,R,q=!0){R.forEach(te=>{!a(this,i)[te].isEnabled()||a(this,i)[te].setPressed(w)}),q&&this.emit("change",this)}}i=new WeakMap,t.Gamepad=s;class r{constructor(E,w){c(this,o,void 0);c(this,n,void 0);l(this,o,E),l(this,n,w)}isPressed(){return a(this,o)}setPressed(E){l(this,o,E)}isEnabled(){return a(this,n)}}o=new WeakMap,n=new WeakMap})(O||(O={}));const Ke=O.Gamepad,P=O.Buttons;var b=(t=>(t[t.Slowest=1]="Slowest",t[t.Slow=2]="Slow",t[t.Mid=4]="Mid",t[t.Fast=5]="Fast",t))(b||{}),G,be,F,we;class Y{constructor(e,s,r,i,o,n,h,E=!1){c(this,G);c(this,F);p(this,"movementType");p(this,"movement");p(this,"gamepad");p(this,"speed");this.name=e,this.sprite=s,this.gamepad=new Ke,this.sprite.setOrigin(0,0),this.sprite.setPosition(r*u.graphics.tileWidth,i*u.graphics.tileHeight),this.sprite.setImmovable(E),this.sprite.setScale(2.5),Ve(this.name,o,this.sprite.anims,n,h),this.sprite.anims.play("initial"),this.gamepad.addListener("change",M(this,G,be),this)}update(e,s){M(this,F,we).call(this)}}G=new WeakSet,be=function(e){e.isPressed(P.Right)?this.sprite.anims.play("right",!0):e.isPressed(P.Left)?this.sprite.anims.play("left",!0):e.isPressed(P.Up)?this.sprite.anims.play("up",!0):e.isPressed(P.Down)?this.sprite.anims.play("down",!0):this.sprite.anims.pause()},F=new WeakSet,we=function(){this.gamepad.isPressed(P.Up)?this.sprite.setVelocityY(-this.speed*30):this.gamepad.isPressed(P.Down)?this.sprite.setVelocityY(this.speed*30):this.sprite.setVelocityY(0),this.gamepad.isPressed(P.Right)?this.sprite.setVelocityX(this.speed*30):this.gamepad.isPressed(P.Left)?this.sprite.setVelocityX(-this.speed*30):this.sprite.setVelocityX(0)};const Ue=O.Buttons,We=6;var X,ye;class Ge extends Y{constructor(s,r,i,o){const n=s.physics.add.sprite(0,0,"bomberman");super("bomberman",n,i,o,[{key:"initial",row:0,frames:[0]},{key:"up",row:1,frames:[2,1,0,1]},{key:"down",row:2,frames:[2,1,0,1]},{key:"right",row:3,frames:[2,1,0,1]},{key:"left",row:4,frames:[2,1,0,1]},{key:"death",row:5,frames:[0,1,2,3,4]}],6,We);c(this,X);this.bombs=r,this.speed=b.Mid,this.sprite.setDepth(1)}update(s,r,i,o){super.update(s,r),M(this,X,ye).call(this,i,o)}}X=new WeakSet,ye=function(s,r){if(this.gamepad.isPressed(Ue.A)&&!s.overlap(this.sprite,this.bombs.group)&&!s.overlap(this.sprite,r.bricks.group)){const i=this.sprite.getCenter(),{x:o,y:n}=Ie(i.x,i.y);this.bombs.addBomb(o,n)}};const Fe=3;class Xe extends Y{constructor(e,s,r){super("bomb",e.get(),s,r,[{key:"initial",row:0,frames:[0,1,2]}],6,Fe,!0)}}class Ye{constructor(e){p(this,"group");this.group=e.physics.add.group({defaultKey:"bomb"})}addBomb(e,s){new Xe(this.group,e,s)}}const qe=3;class Je extends Y{constructor(e,s,r){super("brick",e.get(),s,r,[{key:"initial",row:0,frames:[0]},{key:"dead",row:5,frames:[0,1,2]}],6,qe,!0)}}class ze{constructor(e){p(this,"group");this.group=e.physics.add.group({defaultKey:"brick"})}generateRandom(e){e.randomBricks().forEach(r=>new Je(this.group,r.x,r.y))}}const U=O.Buttons;O.Gamepad;var ve=(t=>(t[t.Low=0]="Low",t[t.Mid=1]="Mid",t[t.High=2]="High",t[t.Impossible=3]="Impossible",t))(ve||{}),A,j,f,H;class Qe{constructor(e){c(this,A,void 0);c(this,j,void 0);c(this,f,[]);c(this,H,void 0);if(l(this,A,e),l(this,j,a(this,A).gamepad),a(this,A).movementType===3)throw new Error("Impossible movement type hasn't been implemented")}start(){const e=()=>{a(this,A).movementType===0?this.makeMovement(L(0,3)):this.makeMovement(L(0,1),L(2,3))};e(),l(this,H,setInterval(e,3e3))}stop(){clearInterval(a(this,H))}makeMovement(e,s){a(this,j).pressMany(!1,a(this,f),!1),l(this,f,[]),e===0?a(this,f).push(U.Left):e===1&&a(this,f).push(U.Right),e===2||s===2?a(this,f).push(U.Up):(e===3||s===3)&&a(this,f).push(U.Down),a(this,j).pressMany(!0,a(this,f))}}A=new WeakMap,j=new WeakMap,f=new WeakMap,H=new WeakMap;const Te=5;class D extends Y{constructor(e,s,r,i){super(e,s,r,i,[{key:"initial",row:1,frames:[0]},{key:"up",row:1,frames:[0,1,2]},{key:"down",row:2,frames:[0,1,2]},{key:"right",row:3,frames:[0,1,2]},{key:"left",row:4,frames:[0,1,2]},{key:"death",row:5,frames:[0,1,2,3]}],5,Te),this.movement=new Qe(this),this.sprite.setDepth(1),this.sprite.setBounce(1,1)}}var Ze=Object.defineProperty,et=Object.getOwnPropertyDescriptor,tt=(t,e,s,r)=>{for(var i=r>1?void 0:r?et(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&Ze(e,s,i),i};let ne=class extends D{constructor(t,e,s){super("balloom",t.get(),e,s),this.speed=b.Slowest,this.movementType=ve.Low,this.sprite.setDepth(1)}};ne=tt([_({type:g.BALLOOM})],ne);var st=Object.defineProperty,it=Object.getOwnPropertyDescriptor,rt=(t,e,s,r)=>{for(var i=r>1?void 0:r?it(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&st(e,s,i),i};let ae=class extends D{constructor(t,e,s){super("doll",t.get(),e,s),this.speed=b.Slow,this.sprite.setDepth(1)}};ae=rt([_({type:g.DOLL})],ae);var ot=Object.defineProperty,nt=Object.getOwnPropertyDescriptor,at=(t,e,s,r)=>{for(var i=r>1?void 0:r?nt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&ot(e,s,i),i};let he=class extends D{constructor(t,e,s){super("kondoria",t.get(),e,s),this.speed=b.Slowest,this.sprite.setDepth(1)}};he=at([_({type:g.KONDORIA})],he);var ht=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,ct=(t,e,s,r)=>{for(var i=r>1?void 0:r?pt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&ht(e,s,i),i};let pe=class extends D{constructor(t,e,s){super("minvo",t.get(),e,s),this.speed=b.Mid,this.sprite.setDepth(1)}};pe=ct([_({type:g.MINVO})],pe);var lt=Object.defineProperty,ut=Object.getOwnPropertyDescriptor,mt=(t,e,s,r)=>{for(var i=r>1?void 0:r?ut(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&lt(e,s,i),i};let ce=class extends D{constructor(t,e,s){super("oneal",t.get(),e,s),this.speed=b.Slow,this.sprite.setDepth(1)}};ce=mt([_({type:g.ONEAL})],ce);var dt=Object.defineProperty,ft=Object.getOwnPropertyDescriptor,gt=(t,e,s,r)=>{for(var i=r>1?void 0:r?ft(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&dt(e,s,i),i};let le=class extends D{constructor(t,e,s){super("ovapi",t.get(),e,s),this.speed=b.Slowest,this.sprite.setDepth(1)}};le=gt([_({type:g.OVAPI})],le);var bt=Object.defineProperty,wt=Object.getOwnPropertyDescriptor,yt=(t,e,s,r)=>{for(var i=r>1?void 0:r?wt(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&bt(e,s,i),i};let ue=class extends D{constructor(t,e,s){super("pass",t.get(),e,s),this.speed=b.Mid,this.sprite.setDepth(1)}};ue=yt([_({type:g.PASS})],ue);var vt=Object.defineProperty,Ot=Object.getOwnPropertyDescriptor,Pt=(t,e,s,r)=>{for(var i=r>1?void 0:r?Ot(e,s):e,o=t.length-1,n;o>=0;o--)(n=t[o])&&(i=(r?n(e,s,i):n(i))||i);return r&&i&&vt(e,s,i),i};let me=class extends D{constructor(t,e,s){super("pontan",t.get(),e,s),this.speed=b.Mid,this.sprite.setDepth(1)}};me=Pt([_({type:g.PONTAN})],me);var V;class Lt{constructor(e){c(this,V,[]);p(this,"group");this.group=e.physics.add.group({defaultKey:"brick"})}generateRandom(e){e.randomEnemies().forEach(r=>{var n;const i=Ee(r.type),o=new i(this.group,r.x,r.y);a(this,V).push(o),(n=o.movement)==null||n.start()})}update(e,s){a(this,V).forEach(r=>r.update(e,s))}}V=new WeakMap;var $,N;class _t{constructor(e){p(this,"itemTileSetLayer");c(this,$,void 0);c(this,N,void 0);p(this,"bricks");p(this,"enemies");l(this,$,new v),l(this,N,e.make.tilemap({data:a(this,$).emptyMap,width:u.graphics.sceneWidth,height:u.graphics.sceneHeight,tileWidth:u.graphics.tileWidth,tileHeight:u.graphics.tileHeight}));const s=a(this,N).addTilesetImage("items",void 0,16,16);this.itemTileSetLayer=a(this,N).createLayer(0,s),this.bricks=new ze(e),this.enemies=new Lt(e),a(this,N).setCollision(0)}reset(){this.bricks.generateRandom(a(this,$)),this.enemies.generateRandom(a(this,$))}update(e,s){this.enemies.update(e,s)}}$=new WeakMap,N=new WeakMap;const x=O.Buttons,Oe={Up:x.Up,Down:x.Down,Left:x.Left,Right:x.Right,x:x.A,c:x.B,Enter:x.Start};function de(t,e){return s=>{const r=Oe[e];fe(r)||t.gamepad.press(r,s.isDown)}}function Dt(t,e){const s=t.addKeys(Object.keys(Oe).join(","),!0,!0);Object.entries(s).forEach(([r,i])=>{i.on("down",de(e,r)),i.on("up",de(e,r))})}const y=O.Buttons;function Mt(t){const e=t.gamepad,s=Ae.create({mode:"static",position:{left:"100px",bottom:"100px"}});s.on("end",()=>{e.pressMany(!1,[y.Right,y.Up,y.Left,y.Down])}),s.on("move",(r,i)=>{const o=[],n=[];let h;!i.distance||(h=i.angle.degree<=60||i.angle.degree>=300?o:n,h.push(y.Right),h=i.angle.degree>=30&&i.angle.degree<=150?o:n,h.push(y.Up),h=i.angle.degree>=120&&i.angle.degree<=240?o:n,h.push(y.Left),h=i.angle.degree>=210&&i.angle.degree<=330?o:n,h.push(y.Down),e.pressMany(!0,o),e.pressMany(!1,n))})}function xt(t){const e=t.gamepad,s=document.querySelector("body"),r=document.createElement("div"),i=document.createElement("img");i.src="assets/joystick/bomb-btn.png",r.appendChild(i),Object.assign(r.style,{bottom:"50px",display:"flex",opacity:"0.5",position:"absolute",right:"50px",transition:"opacity 250ms ease 0s"}),Object.assign(i.style,{width:"100px",pointerEvents:"none",userSelect:"none"}),s.appendChild(r);const o=n=>{n.stopPropagation();const h=n.type==="pointerdown";r.style.opacity=h?"0.8":"0.5",e.press(y.A,h)};r.addEventListener("pointerdown",o),r.addEventListener("pointerup",o)}function Ct(t){Mt(t),xt(t)}const T=16,Z=16;class St extends ge.exports.Scene{constructor(){super("GameScene");p(this,"bomberman");p(this,"bombs");p(this,"tileMap")}preload(){this.load.image("items","assets/map/items.png"),this.load.spritesheet("brick","assets/map/brick.png",{frameWidth:T,frameHeight:Z}),this.load.spritesheet("bomb","assets/map/bomb.png",{frameWidth:T,frameHeight:Z}),["bomberman","balloom","doll","kondoria","minvo","oneal","ovapi","pass","pontan"].forEach(s=>this.load.spritesheet(s,`assets/players/${s}.png`,{frameWidth:T,frameHeight:Z}))}create(){this.tileMap=new _t(this),this.tileMap.reset(),this.cameras.main.setBounds(0,0,u.graphics.sceneWidth,u.graphics.sceneHeight),this.physics.world.setBounds(0,0,u.graphics.sceneWidth,u.graphics.sceneHeight),this.bombs=new Ye(this),this.bomberman=new Ge(this,this.bombs,1,1),this.physics.add.collider(this.bomberman.sprite,this.tileMap.itemTileSetLayer),this.physics.add.collider(this.bombs.group,this.tileMap.itemTileSetLayer),this.physics.add.collider(this.bombs.group,this.bombs.group),this.physics.add.collider(this.bomberman.sprite,this.bombs.group),this.physics.add.collider(this.tileMap.enemies.group,[this.bombs.group,this.tileMap.bricks.group]),this.physics.add.collider(this.tileMap.enemies.group,this.tileMap.itemTileSetLayer),this.cameras.main.startFollow(this.bomberman.sprite,!0),Dt(this.input.keyboard,this.bomberman),Ct(this.bomberman)}update(s,r){super.update(s,r),this.bomberman.update(s,r,this.physics,this.tileMap),this.tileMap.update(s,r)}}new ge.exports.Game(K(k({},Re),{scene:[St]}));
