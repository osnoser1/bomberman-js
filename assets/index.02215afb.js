var Qe=Object.defineProperty,Ze=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var me=(s,t,e)=>t in s?Qe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,se=(s,t)=>{for(var e in t||(t={}))tt.call(t,e)&&me(s,e,t[e]);if(De)for(var e of De(t))st.call(t,e)&&me(s,e,t[e]);return s},ie=(s,t)=>Ze(s,et(t));var p=(s,t,e)=>(me(s,typeof t!="symbol"?t+"":t,e),e),ue=(s,t,e)=>{if(!t.has(s))throw TypeError("Cannot "+e)};var l=(s,t,e)=>(ue(s,t,"read from private field"),e?e.call(s):t.get(s)),d=(s,t,e)=>{if(t.has(s))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(s):t.set(s,e)},f=(s,t,e,r)=>(ue(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e);var w=(s,t,e)=>(ue(s,t,"access private method"),e);import{i as Ve,r as L,o as it,m as rt,a as ot,n as at,p as Ge}from"./vendor.b8ce2bad.js";const nt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}};nt();var D=(s=>(s[s.BALLOOM=0]="BALLOOM",s[s.ONEAL=1]="ONEAL",s[s.DOLL=2]="DOLL",s[s.MINVO=3]="MINVO",s[s.KONDORIA=4]="KONDORIA",s[s.OVAPI=5]="OVAPI",s[s.PASS=6]="PASS",s[s.PONTAN=7]="PONTAN",s[s.Length=8]="Length",s))(D||{});const be={};function S(s){return t=>{lt(ie(se({},s),{enemyClass:t}))}}function lt(s){if(Ve(s.type))throw new TypeError("config.type is required");if(be[s.type])throw new Error(`The enemy with the name "${s.enemyClass.name}" has already exists, please try another name!`);be[s.type]=s.enemyClass}function pt(s){return be[s]}const fe=0,F=1,ke=Number.EPSILON;var M,j,T,V,ae;const v=class{constructor(){d(this,V);d(this,M,void 0);d(this,j,void 0);d(this,T,void 0);f(this,M,w(this,V,ae).call(this,fe,F)),f(this,j,[]),f(this,T,[])}static isSolidBlock(t,e){return e%2!=1&&t%2!=1||e<=0||e>=12||t<=0||t>=30}get emptyMap(){return w(this,V,ae).call(this,fe,F)}get value(){return l(this,M)}randomBricks(){f(this,M,w(this,V,ae).call(this,fe,F)),f(this,j,[]);for(let t=0;t<v.BrickCount;t++)do{let e=L(v.Columns-2),r=L(v.Rows-2);if(!(e<3&&r==1||e==1&&r<3)&&l(this,M)[r][e]===F){l(this,j).push({x:e,y:r}),l(this,M)[r][e]=ke;break}}while(!0);return l(this,j)}randomEnemies(){f(this,T,[]);for(let t=0;t<v.EnemiesCount;t++)do{let e=L(v.Columns-2),r=L(v.Rows-2),i=L(D.Length-1);if(l(this,M)[r][e]===F){l(this,T).push({x:e,y:r,type:i}),l(this,M)[r][e]=ke;break}}while(!0);return l(this,T)}};let N=v;M=new WeakMap,j=new WeakMap,T=new WeakMap,V=new WeakSet,ae=function(t,e){const r=[];for(let i=0;i<v.Rows;i++){r.push([]);for(let o=0;o<v.Columns;o++){const a=v.isSolidBlock(o,i)?t:e;r[i].push(a)}}return r},p(N,"Columns",31),p(N,"Rows",13),p(N,"BrickCount",55),p(N,"EnemiesCount",10);const ht=Phaser.Scale.ScaleModes,ct=Phaser.Scale.Center,Ee=40,Be=40,u={scale:{width:640,height:520},graphics:{tile:{width:Ee,height:Be},sceneWidth:N.Columns*Ee,sceneHeight:N.Rows*Be}},dt={type:Phaser.AUTO,fps:{target:60},pixelArt:!0,scale:{width:u.scale.width,height:u.scale.height,mode:ht.FIT,autoCenter:ct.CENTER_BOTH},physics:{default:"arcade",arcade:{debug:!0}}},mt=(s,t)=>e=>s*t+e;function He(s,t,e,r,i){t.forEach(o=>{var a;e.create({key:o.key,frames:e.generateFrameNumbers(s,{frames:o.frames.map(mt(o.row,r))}),frameRate:i,repeat:(a=o.repeat)!=null?a:-1})})}const ut=Phaser.Events.EventEmitter;var C;(s=>{var i,o,a;let t;(n=>{n[n.Up=0]="Up",n[n.Down=1]="Down",n[n.Left=2]="Left",n[n.Right=3]="Right",n[n.A=4]="A",n[n.B=5]="B",n[n.Start=6]="Start",n[n.None=7]="None"})(t=s.Buttons||(s.Buttons={}));class e extends ut{constructor(){super(...arguments);d(this,i,ie(se({},it(rt(t,()=>new r(!1,!0)),(h,y)=>ot(Number(y)))),{[7]:new r(!0,!0)}))}isPressed(...h){return h.some(y=>l(this,i)[y].isPressed())}press(h,y,k=!0){!l(this,i)[h].isEnabled()||(l(this,i)[h].setPressed(y),k&&this.emit("change",this))}pressMany(h,y,k=!0){y.forEach(ee=>{!l(this,i)[ee].isEnabled()||l(this,i)[ee].setPressed(h)}),k&&this.emit("change",this)}}i=new WeakMap,s.Gamepad=e;class r{constructor(c,h){d(this,o,void 0);d(this,a,void 0);f(this,o,c),f(this,a,h)}isPressed(){return l(this,o)}setPressed(c){f(this,o,c)}isEnabled(){return l(this,a)}}o=new WeakMap,a=new WeakMap})(C||(C={}));function Pe(s){return{x:Math.trunc(s.x/u.graphics.tile.width),y:Math.trunc(s.y/u.graphics.tile.height)}}function ft(s){return s%2===0}const gt=C.Gamepad,g=C.Buttons,yt=Phaser.Physics.Arcade.Sprite;var P=(s=>(s[s.Slowest=1]="Slowest",s[s.Slow=2]="Slow",s[s.Mid=4]="Mid",s[s.Fast=5]="Fast",s))(P||{});const bt={x:[g.Left,g.Right],y:[g.Up,g.Down]},wt={x:"width",y:"height"};var le,Fe,pe,Ke;class Z extends yt{constructor(e,r,i,o,a,n,c,h="initial"){super(e,0,0,r);d(this,le);d(this,pe);p(this,"movement");p(this,"movementType");p(this,"gamepad");p(this,"speed");e.add.existing(this),e.physics.add.existing(this),this.gamepad=new gt,this.name=r,this.setOrigin(0,0),this.setPosition(i*u.graphics.tile.width,o*u.graphics.tile.height),this.setScale(2.5),He(this.name,a,this.anims,n,c),this.anims.play(h),this.gamepad.addListener("change",w(this,le,Fe),this),e.events.on("update",this.update,this)}update(e,r){super.update(e,r),this.anims&&w(this,pe,Ke).call(this)}kill(){if(!this.anims.exists("death")){this.scene.events.off("update",this.update,this),this.destroy();return}this.anims.play("death"),this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{var e;(e=this.scene)==null||e.events.off("update",this.update,this),this.destroy()})}startMovement(){var e;(e=this.movement)==null||e.start()}handleExtraMovement(e,r){if(this.gamepad.isPressed(...bt[r]))return;const i=this.getCenter(),o=i[r]%u.graphics.tile[wt[r]],a=Pe(i);ft(a[r])||(o>=6&&o<20?this.body.velocity[r]=e:o>20&&o<34?this.body.velocity[r]=-e:this.body.velocity[r]=0)}}le=new WeakSet,Fe=function(e){this.anims.getName()!=="death"&&(e.isPressed(g.Right)?this.anims.play("right",!0):e.isPressed(g.Left)?this.anims.play("left",!0):e.isPressed(g.Up)?this.anims.play("up",!0):e.isPressed(g.Down)?this.anims.play("down",!0):this.anims.pause())},pe=new WeakSet,Ke=function(){if(this.anims.getName()==="death"){this.setVelocity(0,0);return}const e=this.speed*30;this.gamepad.isPressed(g.Up)?this.setVelocityY(-e):this.gamepad.isPressed(g.Down)?this.setVelocityY(e):this.setVelocityY(0),this.gamepad.isPressed(g.Right)?this.setVelocityX(e):this.gamepad.isPressed(g.Left)?this.setVelocityX(-e):this.setVelocityX(0),this.gamepad.isPressed(g.Right,g.Left)&&this.handleExtraMovement(e,"y"),this.gamepad.isPressed(g.Up,g.Down)&&this.handleExtraMovement(e,"x")};const m={FireUp:"fire-up",BombUp:"bomb-up",RemoteControl:"remote-control",SpeedUp:"speed-up",WallPass:"wall-pass",BombPass:"bomb-pass",FlamePass:"flame-pass",Invincible:"invincible",Door:"door"},ge={[m.FireUp]:s=>s.fireLength++,[m.BombUp]:s=>s.bombLength++,[m.RemoteControl]:s=>s.detonator=!0,[m.SpeedUp]:s=>s.speed=P.Fast,[m.BombPass]:s=>s.setBombPass(!0),[m.WallPass]:s=>s.wallPass=!0,[m.FlamePass]:s=>s.flamePass=!0,[m.Invincible]:()=>{},[m.Door]:()=>{}},Oe=class extends Z{constructor(t,e,r,i){super(t,Oe.playerName,r,i,[{key:m.FireUp,row:0,frames:[0]},{key:m.BombUp,row:0,frames:[1]},{key:m.RemoteControl,row:0,frames:[2]},{key:m.SpeedUp,row:0,frames:[3]},{key:m.BombPass,row:0,frames:[4]},{key:m.WallPass,row:0,frames:[5]},{key:m.FlamePass,row:0,frames:[6]},{key:m.Invincible,row:0,frames:[7]},{key:m.Door,row:0,frames:[8]}],9,1,e),this.itemType=e}applySkill(t){var e;(e=ge[this.itemType])==null||e.call(ge,t),this.kill()}};let W=Oe;p(W,"playerName","item");const vt=8;var G;const Me=class extends Z{constructor(e,r,i,o,a){super(e,Me.playerName,i,o,[{key:"initial",row:0,frames:[0]},{key:"death",row:5,frames:[0,1,2],repeat:0}],6,vt);d(this,G,void 0);f(this,G,a),this.setHiddenItem(r,i,o)}setHiddenItem(e,r,i){!l(this,G)||this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{const o=new W(e.scene,l(this,G),r,i);e.add(o)})}};let R=Me;G=new WeakMap,p(R,"playerName","brick");class Pt{constructor(t){p(this,"group");p(this,"itemsGroup");this.group=t.physics.add.group({defaultKey:R.playerName,immovable:!0}),this.itemsGroup=t.physics.add.group({defaultKey:W.playerName})}generateRandom(t){const e=t.randomBricks(),r=L(e.length-1),i=Object.values(m);e.forEach((o,a)=>{const n=i[L(i.length-2)],c=r===a?m.Door:n,h=new R(this.group.scene,this.itemsGroup,o.x,o.y,c);this.group.add(h,!0)})}}const re=C.Buttons;C.Gamepad;var Xe=(s=>(s[s.Low=0]="Low",s[s.Mid=1]="Mid",s[s.High=2]="High",s[s.Impossible=3]="Impossible",s))(Xe||{}),I,H,x,X;class Ot{constructor(t){d(this,I,void 0);d(this,H,void 0);d(this,x,[]);d(this,X,void 0);if(f(this,I,t),f(this,H,l(this,I).gamepad),l(this,I).movementType===3)throw new Error("Impossible movement type hasn't been implemented")}start(){const t=()=>{l(this,I).movementType===0?this.makeMovement(L(0,3)):this.makeMovement(L(0,1),L(2,3))};t(),f(this,X,setInterval(t,3e3))}stop(){clearInterval(l(this,X))}makeMovement(t,e){l(this,H).pressMany(!1,l(this,x),!1),f(this,x,[]),t===0?l(this,x).push(re.Left):t===1&&l(this,x).push(re.Right),t===2||e===2?l(this,x).push(re.Up):(t===3||e===3)&&l(this,x).push(re.Down),l(this,H).pressMany(!0,l(this,x))}}I=new WeakMap,H=new WeakMap,x=new WeakMap,X=new WeakMap;const Mt=5;class A extends Z{constructor(t,e,r,i,o=!1){super(t,e,r,i,[{key:"initial",row:1,frames:[0]},{key:"up",row:1,frames:[0,1,2]},{key:"down",row:2,frames:[0,1,2]},{key:"right",row:3,frames:[0,1,2]},{key:"left",row:4,frames:[0,1,2]},{key:"death",row:5,frames:[0,1,2,3],repeat:0}],5,Mt),this.wallPass=o,this.movement=new Ot(this),this.setDepth(2),this.setBounce(1,1)}kill(){var t;super.kill(),(t=this.movement)==null||t.stop()}applyWallPass(){const t=this.getData("brickCollision");if(!t)throw new Error("collider is not defined");t.active=!this.wallPass}}var xt=Object.defineProperty,Nt=Object.getOwnPropertyDescriptor,Lt=(s,t,e,r)=>{for(var i=r>1?void 0:r?Nt(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&xt(t,e,i),i};let Se=class extends A{constructor(s,t,e){super(s,"balloom",t,e),this.speed=P.Slowest,this.movementType=Xe.Low}};Se=Lt([S({type:D.BALLOOM})],Se);var Ct=Object.defineProperty,Dt=Object.getOwnPropertyDescriptor,kt=(s,t,e,r)=>{for(var i=r>1?void 0:r?Dt(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&Ct(t,e,i),i};let Ae=class extends A{constructor(s,t,e){super(s,"doll",t,e),this.speed=P.Slow}};Ae=kt([S({type:D.DOLL})],Ae);var Et=Object.defineProperty,Bt=Object.getOwnPropertyDescriptor,St=(s,t,e,r)=>{for(var i=r>1?void 0:r?Bt(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&Et(t,e,i),i};let _e=class extends A{constructor(s,t,e){super(s,"kondoria",t,e,!0),this.speed=P.Slowest}};_e=St([S({type:D.KONDORIA})],_e);var At=Object.defineProperty,_t=Object.getOwnPropertyDescriptor,jt=(s,t,e,r)=>{for(var i=r>1?void 0:r?_t(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&At(t,e,i),i};let je=class extends A{constructor(s,t,e){super(s,"minvo",t,e),this.speed=P.Mid}};je=jt([S({type:D.MINVO})],je);var Tt=Object.defineProperty,It=Object.getOwnPropertyDescriptor,$t=(s,t,e,r)=>{for(var i=r>1?void 0:r?It(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&Tt(t,e,i),i};let Te=class extends A{constructor(s,t,e){super(s,"oneal",t,e),this.speed=P.Slow}};Te=$t([S({type:D.ONEAL})],Te);var Rt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Wt=(s,t,e,r)=>{for(var i=r>1?void 0:r?Ut(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&Rt(t,e,i),i};let Ie=class extends A{constructor(s,t,e){super(s,"ovapi",t,e,!0),this.speed=P.Slowest}};Ie=Wt([S({type:D.OVAPI})],Ie);var Vt=Object.defineProperty,Gt=Object.getOwnPropertyDescriptor,Ht=(s,t,e,r)=>{for(var i=r>1?void 0:r?Gt(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&Vt(t,e,i),i};let $e=class extends A{constructor(s,t,e){super(s,"pass",t,e),this.speed=P.Mid}};$e=Ht([S({type:D.PASS})],$e);var Ft=Object.defineProperty,Kt=Object.getOwnPropertyDescriptor,Xt=(s,t,e,r)=>{for(var i=r>1?void 0:r?Kt(t,e):t,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(t,e,i):a(i))||i);return r&&i&&Ft(t,e,i),i};let Re=class extends A{constructor(s,t,e){super(s,"pontan",t,e,!0),this.speed=P.Mid}};Re=Xt([S({type:D.PONTAN})],Re);class Yt{constructor(t){p(this,"group");this.group=t.physics.add.group()}generateRandom(t){const e=this.group.scene;t.randomEnemies().forEach(i=>{const o=pt(i.type),a=new o(this.group.scene,i.x,i.y);this.group.add(a);const n=e.physics.add.collider(a,e.tileMap.bricks.group);a.setData("brickCollision",n),e.physics.add.collider(e.tileMap.enemies.group,e.tileMap.itemTileSetLayer),a.applyWallPass(),a.startMovement()})}}const qt={right:"horizontal",left:"horizontal",up:"vertical",down:"vertical"},zt=8;function oe(s,t,e){return s==="x"&&(t==="up"||t==="down")||s==="y"&&(t==="right"||t==="left")?0:e*(t==="up"||t==="left"?-1:1)}function Jt(s,t){return s==="up"||s==="down"?{width:u.graphics.tile.width,height:t*u.graphics.tile.height}:{width:t*u.graphics.tile.width,height:u.graphics.tile.height}}var Y,we,q,ve;const K=class{constructor(t,e,r){d(this,Y);d(this,q);p(this,"group");this.group=t.physics.add.group({defaultKey:K.playerName});const i=[{key:"center",row:0,frames:[0,1,2,3],repeat:0},{key:"up",row:1,frames:[0,1,2,3],repeat:0},{key:"down",row:2,frames:[0,1,2,3],repeat:0},{key:"right",row:3,frames:[0,1,2,3],repeat:0},{key:"left",row:4,frames:[0,1,2,3],repeat:0},{key:"horizontal",row:5,frames:[0,1,2,3],repeat:0},{key:"vertical",row:6,frames:[0,1,2,3],repeat:0}],o=["up","down","left","right"],a=w(this,Y,we).call(this,i);a.anims.play("center"),a.setPosition(e.x*u.graphics.tile.width,e.y*u.graphics.tile.height);for(const n of o){const c={x:e.x+oe("x",n,n==="right"?1:r),y:e.y+oe("y",n,n==="down"?1:r)},h=t.tileMap.tileMap.tileToWorldXY(c.x,c.y),y=Jt(n,r);t.tileMap.tileMap.getTilesWithinWorldXY(h.x+1,h.y+1,y.width-2,y.height-2,{isColliding:!0});const k=t.physics.overlapRect(h.x+1,h.y+1,y.width-2,y.height-2,!0,!0);(n==="right"||n==="down")&&k.reverse();const ee=k.filter(E=>{var b;return((b=E.gameObject)==null?void 0:b.name)===R.playerName}),Je=k.filter(E=>{var b;return((b=E.gameObject)==null?void 0:b.name)===B.playerName}),Le=t.physics.closest(a,ee),Ce=t.physics.closest(a,Je);for(let E=1;E<=r;E++){const b={x:e.x+oe("x",n,E),y:e.y+oe("y",n,E)};if(N.isSolidBlock(b.x,b.y))break;const te=t.tileMap.tileMap.tileToWorldXY(b.x,b.y);if(Le&&te.equals(Le)||Ce&&te.equals(Ce)){w(this,q,ve).call(this,k,b,t.tileMap.tileMap);break}const de=w(this,Y,we).call(this,i);de.setPosition(te.x,te.y),E===r?de.anims.play(n):de.anims.play(qt[n]),w(this,q,ve).call(this,k,b,t.tileMap.tileMap)}}}};let ne=K;Y=new WeakSet,we=function(t){const e=this.group.get();return e.setName(K.playerName),e.setOrigin(0,0),e.setImmovable(!0),e.setScale(2.5),e.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>e.destroy()),He("fire",t,e.anims,4,zt),e},q=new WeakSet,ve=function(t,e,r){t.filter(i=>r.worldToTileXY(i.center.x,i.center.y).equals(e)).forEach(i=>{var o,a;i.gameObject.name===B.playerName?(o=i.gameObject)==null||o.detonate():i.gameObject.name!==K.playerName&&(!(i.gameObject instanceof U)||!i.gameObject.flamePass)&&((a=i.gameObject)==null||a.kill())})},p(ne,"playerName","fire");const Qt=3;var z;const xe=class extends Z{constructor(e,r,i,o){super(e,xe.playerName,i,o,[{key:"initial",row:0,frames:[0,1,2]},{key:"death",row:0,frames:[3],repeat:0}],4,Qt);d(this,z,void 0);f(this,z,r),this.setDepth(1),r.detonator||setTimeout(()=>{this.detonate()},3200)}detonate(){if(!this.anims||this.anims.getName()==="death")return;const e=this.scene;this.anims.play("death"),this.kill();const r=Pe(this.getCenter());new ne(e,r,l(this,z).fireLength)}kill(){var e;super.kill(),(e=this.anims)==null||e.complete()}};let B=xe;z=new WeakMap,p(B,"playerName","bomb");class Zt{constructor(t){p(this,"group");this.group=t.physics.add.group({defaultKey:B.playerName,immovable:!0})}addBomb(t,e,r){const i=new B(this.group.scene,t,e,r);this.group.add(i)}detonate(){const t=this.group.getChildren().at(0);t==null||t.detonate()}}const _=C.Buttons,Ye={Up:_.Up,Down:_.Down,Left:_.Left,Right:_.Right,x:_.A,z:_.B,Enter:_.Start};function Ue(s,t){return e=>{const r=Ye[t];Ve(r)||s.gamepad.press(r,e.isDown)}}function es(s,t){const e=s.addKeys(Object.keys(Ye).join(","),!0,!0);return Object.entries(e).forEach(([r,i])=>{i.on("down",Ue(t,r)),i.on("up",Ue(t,r))}),()=>Object.entries(e).forEach(([r,i])=>{i.destroy()})}const O=C.Buttons;C.Gamepad;function ts(s){const t=s.gamepad,e=at.create({mode:"static",position:{left:"100px",bottom:"100px"}}),r=()=>{t.pressMany(!1,[O.Right,O.Up,O.Left,O.Down])},i=(o,a)=>{const n=[],c=[];let h;!a.distance||(h=a.angle.degree<=60||a.angle.degree>=300?n:c,h.push(O.Right),h=a.angle.degree>=30&&a.angle.degree<=150?n:c,h.push(O.Up),h=a.angle.degree>=120&&a.angle.degree<=240?n:c,h.push(O.Left),h=a.angle.degree>=210&&a.angle.degree<=330?n:c,h.push(O.Down),t.pressMany(!0,n),t.pressMany(!1,c))};return e.on("end",r),e.on("move",i),()=>{e.off("end",r),e.off("move",i)}}function ss(s){const t=s.gamepad,e=document.querySelector("body"),[r,i]=We(t,{src:"assets/joystick/bomb-btn.png",button:O.A,width:"100px",bottom:"50px",right:"50px"}),[o,a]=We(t,{src:"assets/joystick/bomb-explode-btn.png",button:O.B,width:"75px",bottom:"125px",right:"150px"});return e.appendChild(r),e.appendChild(o),()=>{i(),a()}}function We(s,{src:t,button:e,width:r,right:i,bottom:o}){const a=document.createElement("div"),n=document.createElement("img");n.src=t,a.appendChild(n),Object.assign(a.style,{bottom:o,display:"flex",opacity:"0.5",position:"absolute",right:i,transition:"opacity 250ms ease 0s"}),Object.assign(n.style,{width:r,pointerEvents:"none",userSelect:"none"});const c=h=>{h.stopPropagation();const y=h.type==="pointerdown";a.style.opacity=y?"0.8":"0.5",s.press(e,y)};return a.addEventListener("pointerdown",c),a.addEventListener("pointerup",c),[a,()=>{a.removeEventListener("pointerdown",c),a.removeEventListener("pointerup",c)}]}function is(s){const t=ts(s),e=ss(s);return()=>{t(),e()}}const ye=C.Buttons,rs=6;var J,Q,he,qe;const Ne=class extends Z{constructor(e,r,i){super(e,Ne.playerName,r,i,[{key:"initial",row:0,frames:[0]},{key:"up",row:1,frames:[2,1,0,1]},{key:"down",row:2,frames:[2,1,0,1]},{key:"right",row:3,frames:[2,1,0,1]},{key:"left",row:4,frames:[2,1,0,1]},{key:"death",row:5,frames:[0,1,2,3,4],repeat:0}],6,rs);d(this,he);p(this,"bombs");p(this,"bombLength");p(this,"detonator");p(this,"fireLength");p(this,"flamePass");d(this,J,void 0);d(this,Q,void 0);this.bombs=new Zt(e),this.speed=P.Mid,this.detonator=!1,this.fireLength=2,this.bombLength=1,this.flamePass=!1,this.setDepth(3),f(this,J,es(e.input.keyboard,this)),f(this,Q,is(this))}set wallPass(e){const r=this.getData("brickCollision");if(!r)throw new Error("collider is not defined");r.active=!e}update(e,r){super.update(e,r),this.anims&&w(this,he,qe).call(this,this.scene.physics,this.scene.tileMap)}kill(){super.kill(),l(this,J).call(this),l(this,Q).call(this)}setBombPass(e){this.scene.physics.world.colliders.getActive().filter(r=>r.name==="playerBombsCollision").forEach(r=>r.destroy())}};let U=Ne;J=new WeakMap,Q=new WeakMap,he=new WeakSet,qe=function(e,r){if(this.gamepad.isPressed(ye.A)&&this.bombs.group.getLength()<this.bombLength&&!e.overlap(this,this.bombs.group)&&!e.overlap(this,r.bricks.group)){const i=this.getCenter(),{x:o,y:a}=Pe(i);this.bombs.addBomb(this,o,a)}this.gamepad.isPressed(ye.B)&&this.detonator&&(this.bombs.detonate(),this.gamepad.press(ye.B,!1))},p(U,"playerName","bomberman");function os(s,t){const e=s.scene,r=e.tileMap.tileMap.worldToTileXY(s.body.center.x,s.body.center.y),i=e.tileMap.tileMap.worldToTileXY(t.body.center.x,t.body.center.y);return r.equals(i)}var ce,ze;class as{constructor(t,e){d(this,ce);p(this,"group");this.group=t.physics.add.group({defaultKey:U.playerName}),t.physics.add.overlap(this.group,e.itemsGroup,w(this,ce,ze),os)}addPlayer(t,e,r){const i=new U(t,e,r);this.group.add(i);const o=this.group.getChildren().map(c=>c.bombs.group);t.physics.add.collider(i,t.tileMap.itemTileSetLayer),t.physics.add.collider(i.bombs.group,t.tileMap.itemTileSetLayer);const a=t.physics.add.collider(i,t.tileMap.bricks.group);i.setData("brickCollision",a),t.physics.add.collider(i.bombs.group,o);const n=t.physics.add.collider(i,o);i.setData("bombCollision",n),t.physics.add.collider(t.tileMap.enemies.group,i.bombs.group),t.cameras.main.startFollow(i,!0)}update(){const t=this.group.scene;this.group.children.size===0&&this.addPlayer(t,1,1)}}ce=new WeakSet,ze=function(t,e){const r=t.scene,i=t,o=e;o.itemType===m.Door&&r.tileMap.enemies.group.getLength()===0||o.itemType!==m.Door&&o.applySkill(i)};var $;class ns{constructor(t){p(this,"itemTileSetLayer");d(this,$,void 0);p(this,"tileMap");p(this,"bricks");p(this,"enemies");p(this,"players");f(this,$,new N),this.tileMap=t.make.tilemap({data:l(this,$).emptyMap,width:u.graphics.sceneWidth,height:u.graphics.sceneHeight,tileWidth:u.graphics.tile.width,tileHeight:u.graphics.tile.height});const e=this.tileMap.addTilesetImage("map",void 0,16,16);this.itemTileSetLayer=this.tileMap.createLayer(0,e),this.bricks=new Pt(t),this.players=new as(t,this.bricks),this.enemies=new Yt(t),this.tileMap.setCollision(0)}reset(t){this.players.addPlayer(t,1,1),this.bricks.generateRandom(l(this,$)),this.enemies.generateRandom(l(this,$))}update(){this.players.update()}}$=new WeakMap;const ls=16,ps=16;class hs extends Ge.exports.Scene{constructor(){super("GameScene");p(this,"tileMap")}preload(){const e={frameWidth:ls,frameHeight:ps};this.load.image("map","assets/map/map-items.png"),this.load.spritesheet(W.playerName,"assets/map/items.png",e),this.load.spritesheet(R.playerName,"assets/map/brick.png",e),this.load.spritesheet(B.playerName,"assets/map/bomb.png",e),this.load.spritesheet("fire","assets/map/fire.png",e),[U.playerName,"balloom","doll","kondoria","minvo","oneal","ovapi","pass","pontan"].forEach(r=>this.load.spritesheet(r,`assets/players/${r}.png`,e))}create(){this.tileMap=new ns(this),this.tileMap.reset(this),this.cameras.main.setBounds(0,0,u.graphics.sceneWidth,u.graphics.sceneHeight),this.physics.world.setBounds(0,0,u.graphics.sceneWidth,u.graphics.sceneHeight)}update(e,r){super.update(e,r),this.tileMap.update()}}new Ge.exports.Game(ie(se({},dt),{scene:[hs]}));
