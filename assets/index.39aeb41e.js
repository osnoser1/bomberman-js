var ze=Object.defineProperty,Je=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var Le=Object.getOwnPropertySymbols;var Ze=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable;var ce=(s,e,t)=>e in s?ze(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,te=(s,e)=>{for(var t in e||(e={}))Ze.call(e,t)&&ce(s,t,e[t]);if(Le)for(var t of Le(e))et.call(e,t)&&ce(s,t,e[t]);return s},se=(s,e)=>Je(s,Qe(e));var p=(s,e,t)=>(ce(s,typeof e!="symbol"?e+"":e,t),t),me=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var l=(s,e,t)=>(me(s,e,"read from private field"),t?t.call(s):e.get(s)),c=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},f=(s,e,t,r)=>(me(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t);var b=(s,e,t)=>(me(s,e,"access private method"),t);import{i as Ue,r as L,o as tt,m as st,a as it,n as rt,p as We}from"./vendor.b8ce2bad.js";const ot=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}};ot();var C=(s=>(s[s.BALLOOM=0]="BALLOOM",s[s.ONEAL=1]="ONEAL",s[s.DOLL=2]="DOLL",s[s.MINVO=3]="MINVO",s[s.KONDORIA=4]="KONDORIA",s[s.OVAPI=5]="OVAPI",s[s.PASS=6]="PASS",s[s.PONTAN=7]="PONTAN",s[s.Length=8]="Length",s))(C||{});const ge={};function S(s){return e=>{at(se(te({},s),{enemyClass:e}))}}function at(s){if(Ue(s.type))throw new TypeError("config.type is required");if(ge[s.type])throw new Error(`The enemy with the name "${s.enemyClass.name}" has already exists, please try another name!`);ge[s.type]=s.enemyClass}function nt(s){return ge[s]}const de=0,H=1,De=Number.EPSILON;var M,I,j,F,oe;const v=class{constructor(){c(this,F);c(this,M,void 0);c(this,I,void 0);c(this,j,void 0);f(this,M,b(this,F,oe).call(this,de,H)),f(this,I,[]),f(this,j,[])}static isSolidBlock(e,t){return t%2!=1&&e%2!=1||t<=0||t>=12||e<=0||e>=30}get emptyMap(){return b(this,F,oe).call(this,de,H)}get value(){return l(this,M)}randomBricks(){f(this,M,b(this,F,oe).call(this,de,H)),f(this,I,[]);for(let e=0;e<v.BrickCount;e++)do{let t=L(v.Columns-2),r=L(v.Rows-2);if(!(t<3&&r==1||t==1&&r<3)&&l(this,M)[r][t]===H){l(this,I).push({x:t,y:r}),l(this,M)[r][t]=De;break}}while(!0);return l(this,I)}randomEnemies(){f(this,j,[]);for(let e=0;e<v.EnemiesCount;e++)do{let t=L(v.Columns-2),r=L(v.Rows-2),i=L(C.Length-1);if(l(this,M)[r][t]===H){l(this,j).push({x:t,y:r,type:i}),l(this,M)[r][t]=De;break}}while(!0);return l(this,j)}};let N=v;M=new WeakMap,I=new WeakMap,j=new WeakMap,F=new WeakSet,oe=function(e,t){const r=[];for(let i=0;i<v.Rows;i++){r.push([]);for(let o=0;o<v.Columns;o++){const a=v.isSolidBlock(o,i)?e:t;r[i].push(a)}}return r},p(N,"Columns",31),p(N,"Rows",13),p(N,"BrickCount",55),p(N,"EnemiesCount",10);const lt=Phaser.Scale.ScaleModes,pt=Phaser.Scale.Center,Ce=40,Be=40,u={scale:{width:640,height:520},graphics:{tile:{width:Ce,height:Be},sceneWidth:N.Columns*Ce,sceneHeight:N.Rows*Be}},ht={type:Phaser.AUTO,fps:{target:60},pixelArt:!0,scale:{width:u.scale.width,height:u.scale.height,mode:lt.FIT,autoCenter:pt.CENTER_BOTH},physics:{default:"arcade",arcade:{debug:!0}}},ct=(s,e)=>t=>s*e+t;function Fe(s,e,t,r,i){e.forEach(o=>{var a;t.create({key:o.key,frames:t.generateFrameNumbers(s,{frames:o.frames.map(ct(o.row,r))}),frameRate:i,repeat:(a=o.repeat)!=null?a:-1})})}const mt=Phaser.Events.EventEmitter;var D;(s=>{var i,o,a;let e;(n=>{n[n.Up=0]="Up",n[n.Down=1]="Down",n[n.Left=2]="Left",n[n.Right=3]="Right",n[n.A=4]="A",n[n.B=5]="B",n[n.Start=6]="Start",n[n.None=7]="None"})(e=s.Buttons||(s.Buttons={}));class t extends mt{constructor(){super(...arguments);c(this,i,se(te({},tt(st(e,()=>new r(!1,!0)),(h,y)=>it(Number(y)))),{[7]:new r(!0,!0)}))}isPressed(...h){return h.some(y=>l(this,i)[y].isPressed())}press(h,y,B=!0){!l(this,i)[h].isEnabled()||(l(this,i)[h].setPressed(y),B&&this.emit("change",this))}pressMany(h,y,B=!0){y.forEach(Z=>{!l(this,i)[Z].isEnabled()||l(this,i)[Z].setPressed(h)}),B&&this.emit("change",this)}}i=new WeakMap,s.Gamepad=t;class r{constructor(m,h){c(this,o,void 0);c(this,a,void 0);f(this,o,m),f(this,a,h)}isPressed(){return l(this,o)}setPressed(m){f(this,o,m)}isEnabled(){return l(this,a)}}o=new WeakMap,a=new WeakMap})(D||(D={}));function be(s){return{x:Math.trunc(s.x/u.graphics.tile.width),y:Math.trunc(s.y/u.graphics.tile.height)}}function dt(s){return s%2===0}const ut=D.Gamepad,g=D.Buttons;var P=(s=>(s[s.Slowest=1]="Slowest",s[s.Slow=2]="Slow",s[s.Mid=4]="Mid",s[s.Fast=5]="Fast",s))(P||{});const ft={x:[g.Left,g.Right],y:[g.Up,g.Down]},gt={x:"width",y:"height"};var ae,Ge,ne,Ve;class Q{constructor(e,t,r,i,o,a,n,m=!1,h="initial"){c(this,ae);c(this,ne);p(this,"movement");p(this,"movementType");p(this,"gamepad");p(this,"speed");this.name=e,this.sprite=t,this.gamepad=new ut,this.sprite.name=this.name,this.sprite.setData("player",this),this.sprite.setOrigin(0,0),this.sprite.setPosition(r*u.graphics.tile.width,i*u.graphics.tile.height),this.sprite.setImmovable(m),this.sprite.setScale(2.5),Fe(this.name,o,this.sprite.anims,a,n),this.sprite.anims.play(h),this.gamepad.addListener("change",b(this,ae,Ge),this)}update(e,t){b(this,ne,Ve).call(this)}kill(){if(!this.sprite.anims.exists("death")){this.sprite.destroy();return}this.sprite.anims.play("death"),this.sprite.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>this.sprite.destroy())}startMovement(){var e;(e=this.movement)==null||e.start()}handleExtraMovement(e,t){if(this.gamepad.isPressed(...ft[t]))return;const r=this.sprite.getCenter(),i=r[t]%u.graphics.tile[gt[t]],o=be(r);dt(o[t])||(i>=6&&i<20?this.sprite.body.velocity[t]=e:i>20&&i<34?this.sprite.body.velocity[t]=-e:this.sprite.body.velocity[t]=0)}}ae=new WeakSet,Ge=function(e){this.sprite.anims.getName()!=="death"&&(e.isPressed(g.Right)?this.sprite.anims.play("right",!0):e.isPressed(g.Left)?this.sprite.anims.play("left",!0):e.isPressed(g.Up)?this.sprite.anims.play("up",!0):e.isPressed(g.Down)?this.sprite.anims.play("down",!0):this.sprite.anims.pause())},ne=new WeakSet,Ve=function(){if(this.sprite.anims.getName()==="death"){this.sprite.setVelocity(0,0);return}const e=this.speed*30;this.gamepad.isPressed(g.Up)?this.sprite.setVelocityY(-e):this.gamepad.isPressed(g.Down)?this.sprite.setVelocityY(e):this.sprite.setVelocityY(0),this.gamepad.isPressed(g.Right)?this.sprite.setVelocityX(e):this.gamepad.isPressed(g.Left)?this.sprite.setVelocityX(-e):this.sprite.setVelocityX(0),this.gamepad.isPressed(g.Right,g.Left)&&this.handleExtraMovement(e,"y"),this.gamepad.isPressed(g.Up,g.Down)&&this.handleExtraMovement(e,"x")};const d={FireUp:"fire-up",BombUp:"bomb-up",RemoteControl:"remote-control",SpeedUp:"speed-up",WallPass:"wall-pass",BombPass:"bomb-pass",FlamePass:"flame-pass",Invincible:"invincible",Door:"door"},ue={[d.FireUp]:s=>s.fireLength++,[d.BombUp]:s=>s.bombLength++,[d.RemoteControl]:s=>s.detonator=!0,[d.SpeedUp]:s=>s.speed=P.Fast,[d.BombPass]:s=>s.setBombPass(!0),[d.WallPass]:s=>s.setWallPass(!0),[d.FlamePass]:s=>s.flamePass=!0,[d.Invincible]:()=>{},[d.Door]:()=>{}},ve=class extends Q{constructor(e,t,r,i){super(ve.playerName,e,r,i,[{key:d.FireUp,row:0,frames:[0]},{key:d.BombUp,row:0,frames:[1]},{key:d.RemoteControl,row:0,frames:[2]},{key:d.SpeedUp,row:0,frames:[3]},{key:d.BombPass,row:0,frames:[4]},{key:d.WallPass,row:0,frames:[5]},{key:d.FlamePass,row:0,frames:[6]},{key:d.Invincible,row:0,frames:[7]},{key:d.Door,row:0,frames:[8]}],9,1,!1,t),this.itemType=t}applySkill(e){var t;(t=ue[this.itemType])==null||t.call(ue,e),this.kill()}};let W=ve;p(W,"playerName","item");const yt=8;var G;const Pe=class extends Q{constructor(t,r,i,o,a){super(Pe.playerName,t.get(),i,o,[{key:"initial",row:0,frames:[0]},{key:"death",row:5,frames:[0,1,2],repeat:0}],6,yt,!0);c(this,G,void 0);f(this,G,a),this.setHiddenItem(r,i,o)}setHiddenItem(t,r,i){!l(this,G)||this.sprite.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{new W(t.get(),l(this,G),r,i)})}};let k=Pe;G=new WeakMap,p(k,"playerName","brick");class wt{constructor(e){p(this,"group");p(this,"itemsGroup");this.group=e.physics.add.group({defaultKey:k.playerName}),this.itemsGroup=e.physics.add.group({defaultKey:W.playerName})}generateRandom(e){const t=e.randomBricks(),r=L(t.length-1),i=Object.values(d);t.forEach((o,a)=>{const n=i[L(i.length-2)],m=r===a?d.Door:n;new k(this.group,this.itemsGroup,o.x,o.y,m)})}}const ie=D.Buttons;D.Gamepad;var He=(s=>(s[s.Low=0]="Low",s[s.Mid=1]="Mid",s[s.High=2]="High",s[s.Impossible=3]="Impossible",s))(He||{}),$,V,x,K;class bt{constructor(e){c(this,$,void 0);c(this,V,void 0);c(this,x,[]);c(this,K,void 0);if(f(this,$,e),f(this,V,l(this,$).gamepad),l(this,$).movementType===3)throw new Error("Impossible movement type hasn't been implemented")}start(){const e=()=>{l(this,$).movementType===0?this.makeMovement(L(0,3)):this.makeMovement(L(0,1),L(2,3))};e(),f(this,K,setInterval(e,3e3))}stop(){clearInterval(l(this,K))}makeMovement(e,t){l(this,V).pressMany(!1,l(this,x),!1),f(this,x,[]),e===0?l(this,x).push(ie.Left):e===1&&l(this,x).push(ie.Right),e===2||t===2?l(this,x).push(ie.Up):(e===3||t===3)&&l(this,x).push(ie.Down),l(this,V).pressMany(!0,l(this,x))}}$=new WeakMap,V=new WeakMap,x=new WeakMap,K=new WeakMap;const vt=5;class A extends Q{constructor(e,t,r,i){super(e,t,r,i,[{key:"initial",row:1,frames:[0]},{key:"up",row:1,frames:[0,1,2]},{key:"down",row:2,frames:[0,1,2]},{key:"right",row:3,frames:[0,1,2]},{key:"left",row:4,frames:[0,1,2]},{key:"death",row:5,frames:[0,1,2,3],repeat:0}],5,vt),this.movement=new bt(this),this.sprite.setDepth(2),this.sprite.setBounce(1,1)}kill(){var e;super.kill(),(e=this.movement)==null||e.stop()}}var Pt=Object.defineProperty,Ot=Object.getOwnPropertyDescriptor,Mt=(s,e,t,r)=>{for(var i=r>1?void 0:r?Ot(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Pt(e,t,i),i};let Ee=class extends A{constructor(s,e,t){super("balloom",s.get(),e,t),this.speed=P.Slowest,this.movementType=He.Low}};Ee=Mt([S({type:C.BALLOOM})],Ee);var xt=Object.defineProperty,Nt=Object.getOwnPropertyDescriptor,Lt=(s,e,t,r)=>{for(var i=r>1?void 0:r?Nt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&xt(e,t,i),i};let ke=class extends A{constructor(s,e,t){super("doll",s.get(),e,t),this.speed=P.Slow}};ke=Lt([S({type:C.DOLL})],ke);var Dt=Object.defineProperty,Ct=Object.getOwnPropertyDescriptor,Bt=(s,e,t,r)=>{for(var i=r>1?void 0:r?Ct(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Dt(e,t,i),i};let _e=class extends A{constructor(s,e,t){super("kondoria",s.get(),e,t),this.speed=P.Slowest}};_e=Bt([S({type:C.KONDORIA})],_e);var Et=Object.defineProperty,kt=Object.getOwnPropertyDescriptor,_t=(s,e,t,r)=>{for(var i=r>1?void 0:r?kt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Et(e,t,i),i};let Se=class extends A{constructor(s,e,t){super("minvo",s.get(),e,t),this.speed=P.Mid}};Se=_t([S({type:C.MINVO})],Se);var St=Object.defineProperty,At=Object.getOwnPropertyDescriptor,Tt=(s,e,t,r)=>{for(var i=r>1?void 0:r?At(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&St(e,t,i),i};let Ae=class extends A{constructor(s,e,t){super("oneal",s.get(),e,t),this.speed=P.Slow}};Ae=Tt([S({type:C.ONEAL})],Ae);var It=Object.defineProperty,jt=Object.getOwnPropertyDescriptor,$t=(s,e,t,r)=>{for(var i=r>1?void 0:r?jt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&It(e,t,i),i};let Te=class extends A{constructor(s,e,t){super("ovapi",s.get(),e,t),this.speed=P.Slowest}};Te=$t([S({type:C.OVAPI})],Te);var Rt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Wt=(s,e,t,r)=>{for(var i=r>1?void 0:r?Ut(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Rt(e,t,i),i};let Ie=class extends A{constructor(s,e,t){super("pass",s.get(),e,t),this.speed=P.Mid}};Ie=Wt([S({type:C.PASS})],Ie);var Ft=Object.defineProperty,Gt=Object.getOwnPropertyDescriptor,Vt=(s,e,t,r)=>{for(var i=r>1?void 0:r?Gt(e,t):e,o=s.length-1,a;o>=0;o--)(a=s[o])&&(i=(r?a(e,t,i):a(i))||i);return r&&i&&Ft(e,t,i),i};let je=class extends A{constructor(s,e,t){super("pontan",s.get(),e,t),this.speed=P.Mid}};je=Vt([S({type:C.PONTAN})],je);class Ht{constructor(e){p(this,"group");this.group=e.physics.add.group({defaultKey:k.playerName})}generateRandom(e){e.randomEnemies().forEach(r=>{const i=nt(r.type);new i(this.group,r.x,r.y).startMovement()})}update(e,t){this.group.children.each(r=>{r.getData("player").update(e,t)})}}const Kt={right:"horizontal",left:"horizontal",up:"vertical",down:"vertical"},Xt=8;function re(s,e,t){return s==="x"&&(e==="up"||e==="down")||s==="y"&&(e==="right"||e==="left")?0:t*(e==="up"||e==="left"?-1:1)}function Yt(s,e){return s==="up"||s==="down"?{width:u.graphics.tile.width,height:e*u.graphics.tile.height}:{width:e*u.graphics.tile.width,height:u.graphics.tile.height}}var X,ye,Y,we;class qt{constructor(e,t,r){c(this,X);c(this,Y);p(this,"group");this.group=e.physics.add.group({defaultKey:"fire"});const i=[{key:"center",row:0,frames:[0,1,2,3],repeat:0},{key:"up",row:1,frames:[0,1,2,3],repeat:0},{key:"down",row:2,frames:[0,1,2,3],repeat:0},{key:"right",row:3,frames:[0,1,2,3],repeat:0},{key:"left",row:4,frames:[0,1,2,3],repeat:0},{key:"horizontal",row:5,frames:[0,1,2,3],repeat:0},{key:"vertical",row:6,frames:[0,1,2,3],repeat:0}],o=["up","down","left","right"],a=b(this,X,ye).call(this,i);a.anims.play("center"),a.setPosition(t.x*u.graphics.tile.width,t.y*u.graphics.tile.height);for(const n of o){const m={x:t.x+re("x",n,n==="right"?1:r),y:t.y+re("y",n,n==="down"?1:r)},h=e.tileMap.tileMap.tileToWorldXY(m.x,m.y),y=Yt(n,r);e.tileMap.tileMap.getTilesWithinWorldXY(h.x+1,h.y+1,y.width-2,y.height-2,{isColliding:!0});const B=e.physics.overlapRect(h.x+1,h.y+1,y.width-2,y.height-2,!0,!0);(n==="right"||n==="down")&&B.reverse();const Z=B.filter(E=>{var w;return((w=E.gameObject)==null?void 0:w.name)===k.playerName}),qe=B.filter(E=>{var w;return((w=E.gameObject)==null?void 0:w.name)===_.playerName}),xe=e.physics.closest(a,Z),Ne=e.physics.closest(a,qe);for(let E=1;E<=r;E++){const w={x:t.x+re("x",n,E),y:t.y+re("y",n,E)};if(N.isSolidBlock(w.x,w.y))break;const ee=e.tileMap.tileMap.tileToWorldXY(w.x,w.y);if(xe&&ee.equals(xe)||Ne&&ee.equals(Ne)){b(this,Y,we).call(this,B,w,e.tileMap.tileMap);break}const he=b(this,X,ye).call(this,i);he.setPosition(ee.x,ee.y),E===r?he.anims.play(n):he.anims.play(Kt[n]),b(this,Y,we).call(this,B,w,e.tileMap.tileMap)}}}}X=new WeakSet,ye=function(e){const t=this.group.get();return t.setOrigin(0,0),t.setImmovable(!0),t.setScale(2.5),t.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>t.destroy()),Fe("fire",e,t.anims,4,Xt),t},Y=new WeakSet,we=function(e,t,r){e.filter(i=>r.worldToTileXY(i.center.x,i.center.y).equals(t)).forEach(i=>{const o=i.gameObject.getData("player");i.gameObject.name===_.playerName?o==null||o.detonate():(!(o instanceof U)||!o.flamePass)&&(o==null||o.kill())})};const zt=3;var q;const Oe=class extends Q{constructor(t,r,i,o){super(Oe.playerName,t.get(),i,o,[{key:"initial",row:0,frames:[0,1,2]},{key:"death",row:0,frames:[3],repeat:0}],4,zt,!0);c(this,q,void 0);f(this,q,r),this.sprite.setDepth(1),r.detonator||setTimeout(()=>{this.detonate()},3200)}detonate(){if(!this.sprite.anims||this.sprite.anims.getName()==="death")return;const t=this.sprite.scene;this.sprite.anims.play("death"),this.kill();const r=be(this.sprite.getCenter());new qt(t,r,l(this,q).fireLength)}kill(){var t;super.kill(),(t=this.sprite.anims)==null||t.complete()}};let _=Oe;q=new WeakMap,p(_,"playerName","bomb");class Jt{constructor(e){p(this,"group");this.group=e.physics.add.group({defaultKey:_.playerName})}addBomb(e,t,r){new _(this.group,e,t,r)}detonate(){var t;const e=(t=this.group.getChildren().at(0))==null?void 0:t.getData("player");e==null||e.detonate()}}const T=D.Buttons,Ke={Up:T.Up,Down:T.Down,Left:T.Left,Right:T.Right,x:T.A,z:T.B,Enter:T.Start};function $e(s,e){return t=>{const r=Ke[e];Ue(r)||s.gamepad.press(r,t.isDown)}}function Qt(s,e){const t=s.addKeys(Object.keys(Ke).join(","),!0,!0);return Object.entries(t).forEach(([r,i])=>{i.on("down",$e(e,r)),i.on("up",$e(e,r))}),()=>Object.entries(t).forEach(([r,i])=>{i.destroy()})}const O=D.Buttons;D.Gamepad;function Zt(s){const e=s.gamepad,t=rt.create({mode:"static",position:{left:"100px",bottom:"100px"}}),r=()=>{e.pressMany(!1,[O.Right,O.Up,O.Left,O.Down])},i=(o,a)=>{const n=[],m=[];let h;!a.distance||(h=a.angle.degree<=60||a.angle.degree>=300?n:m,h.push(O.Right),h=a.angle.degree>=30&&a.angle.degree<=150?n:m,h.push(O.Up),h=a.angle.degree>=120&&a.angle.degree<=240?n:m,h.push(O.Left),h=a.angle.degree>=210&&a.angle.degree<=330?n:m,h.push(O.Down),e.pressMany(!0,n),e.pressMany(!1,m))};return t.on("end",r),t.on("move",i),()=>{t.off("end",r),t.off("move",i)}}function es(s){const e=s.gamepad,t=document.querySelector("body"),[r,i]=Re(e,{src:"assets/joystick/bomb-btn.png",button:O.A,width:"100px",bottom:"50px",right:"50px"}),[o,a]=Re(e,{src:"assets/joystick/bomb-explode-btn.png",button:O.B,width:"75px",bottom:"125px",right:"150px"});return t.appendChild(r),t.appendChild(o),()=>{i(),a()}}function Re(s,{src:e,button:t,width:r,right:i,bottom:o}){const a=document.createElement("div"),n=document.createElement("img");n.src=e,a.appendChild(n),Object.assign(a.style,{bottom:o,display:"flex",opacity:"0.5",position:"absolute",right:i,transition:"opacity 250ms ease 0s"}),Object.assign(n.style,{width:r,pointerEvents:"none",userSelect:"none"});const m=h=>{h.stopPropagation();const y=h.type==="pointerdown";a.style.opacity=y?"0.8":"0.5",s.press(t,y)};return a.addEventListener("pointerdown",m),a.addEventListener("pointerup",m),[a,()=>{a.removeEventListener("pointerdown",m),a.removeEventListener("pointerup",m)}]}function ts(s){const e=Zt(s),t=es(s);return()=>{e(),t()}}const fe=D.Buttons,ss=6;var z,J,le,Xe;const Me=class extends Q{constructor(t,r,i,o){super(Me.playerName,t,i,o,[{key:"initial",row:0,frames:[0]},{key:"up",row:1,frames:[2,1,0,1]},{key:"down",row:2,frames:[2,1,0,1]},{key:"right",row:3,frames:[2,1,0,1]},{key:"left",row:4,frames:[2,1,0,1]},{key:"death",row:5,frames:[0,1,2,3,4],repeat:0}],6,ss);c(this,le);p(this,"bombs");p(this,"bombLength");p(this,"detonator");p(this,"fireLength");p(this,"flamePass");c(this,z,void 0);c(this,J,void 0);this.bombs=new Jt(r),this.speed=P.Mid,this.detonator=!1,this.fireLength=2,this.bombLength=1,this.flamePass=!1,this.sprite.setDepth(3),f(this,z,Qt(r.input.keyboard,this)),f(this,J,ts(this))}update(t,r,i,o){super.update(t,r),b(this,le,Xe).call(this,i,o)}kill(){super.kill(),l(this,z).call(this),l(this,J).call(this)}setBombPass(t){this.sprite.scene.physics.world.colliders.getActive().filter(r=>r.name==="playerBombsCollision").forEach(r=>r.destroy())}setWallPass(t){this.sprite.scene.physics.world.colliders.getActive().filter(r=>r.name==="playerBrickCollision").forEach(r=>r.destroy())}};let U=Me;z=new WeakMap,J=new WeakMap,le=new WeakSet,Xe=function(t,r){if(this.gamepad.isPressed(fe.A)&&this.bombs.group.getLength()<this.bombLength&&!t.overlap(this.sprite,this.bombs.group)&&!t.overlap(this.sprite,r.bricks.group)){const i=this.sprite.getCenter(),{x:o,y:a}=be(i);this.bombs.addBomb(this,o,a)}this.gamepad.isPressed(fe.B)&&this.detonator&&(this.bombs.detonate(),this.gamepad.press(fe.B,!1))},p(U,"playerName","bomberman");function is(s,e){const t=s.scene,r=t.tileMap.tileMap.worldToTileXY(s.body.center.x,s.body.center.y),i=t.tileMap.tileMap.worldToTileXY(e.body.center.x,e.body.center.y);return r.equals(i)}var pe,Ye;class rs{constructor(e,t){c(this,pe);p(this,"group");this.group=e.physics.add.group({defaultKey:U.playerName}),e.physics.add.overlap(this.group,t.itemsGroup,b(this,pe,Ye),is)}addPlayer(e,t,r){const i=new U(this.group.get(),e,t,r),o=this.group.getChildren().map(a=>a.getData("player").bombs.group);e.physics.add.collider(i.sprite,e.tileMap.itemTileSetLayer),e.physics.add.collider(i.bombs.group,e.tileMap.itemTileSetLayer),e.physics.add.collider(i.sprite,e.tileMap.bricks.group).setName("playerBrickCollision"),e.physics.add.collider(i.bombs.group,o),e.physics.add.collider(i.sprite,o).setName("playerBombsCollision"),e.physics.add.collider(e.tileMap.enemies.group,[i.bombs.group,e.tileMap.bricks.group]),e.physics.add.collider(e.tileMap.enemies.group,e.tileMap.itemTileSetLayer),e.cameras.main.startFollow(i.sprite,!0)}update(e,t,r){const i=this.group.scene;this.group.children.each(o=>{o.getData("player").update(e,t,r,i.tileMap)}),this.group.children.size===0&&this.addPlayer(i,1,1)}}pe=new WeakSet,Ye=function(e,t){const r=e.scene,i=e.getData("player"),o=t.getData("player");o.itemType===d.Door&&r.tileMap.enemies.group.getLength()===0||o.itemType!==d.Door&&o.applySkill(i)};var R;class os{constructor(e){p(this,"itemTileSetLayer");c(this,R,void 0);p(this,"tileMap");p(this,"bricks");p(this,"enemies");p(this,"players");f(this,R,new N),this.tileMap=e.make.tilemap({data:l(this,R).emptyMap,width:u.graphics.sceneWidth,height:u.graphics.sceneHeight,tileWidth:u.graphics.tile.width,tileHeight:u.graphics.tile.height});const t=this.tileMap.addTilesetImage("map",void 0,16,16);this.itemTileSetLayer=this.tileMap.createLayer(0,t),this.bricks=new wt(e),this.players=new rs(e,this.bricks),this.enemies=new Ht(e),this.tileMap.setCollision(0)}reset(e){this.players.addPlayer(e,1,1),this.bricks.generateRandom(l(this,R)),this.enemies.generateRandom(l(this,R))}update(e,t,r){this.players.update(e,t,r.physics),this.enemies.update(e,t)}}R=new WeakMap;const as=16,ns=16;class ls extends We.exports.Scene{constructor(){super("GameScene");p(this,"tileMap")}preload(){const t={frameWidth:as,frameHeight:ns};this.load.image("map","assets/map/map-items.png"),this.load.spritesheet(W.playerName,"assets/map/items.png",t),this.load.spritesheet(k.playerName,"assets/map/brick.png",t),this.load.spritesheet(_.playerName,"assets/map/bomb.png",t),this.load.spritesheet("fire","assets/map/fire.png",t),[U.playerName,"balloom","doll","kondoria","minvo","oneal","ovapi","pass","pontan"].forEach(r=>this.load.spritesheet(r,`assets/players/${r}.png`,t))}create(){this.tileMap=new os(this),this.tileMap.reset(this),this.cameras.main.setBounds(0,0,u.graphics.sceneWidth,u.graphics.sceneHeight),this.physics.world.setBounds(0,0,u.graphics.sceneWidth,u.graphics.sceneHeight)}update(t,r){super.update(t,r),this.tileMap.update(t,r,this)}}new We.exports.Game(se(te({},ht),{scene:[ls]}));
